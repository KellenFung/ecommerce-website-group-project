<html>
<head>
  <title>Best Buy</title>
  <style>
    body {
      background-color: #c8f2c2;
      font-family: Arial, sans-serif;
    }

    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
    }

    #cartButton {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: transparent;
      border: none;
      cursor: pointer;
      position: fixed;
      z-index: 999;
    }

    #cartButton img {
      width: 50px;
      height: 50px;
    }

    #cartButton:hover img {
      transform: scale(1.1);
      transition: transform 0.2s ease-in-out;
    }

    #cartBadge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #ff3333;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      display: none;
    }

    #cartBadge.show {
      display: flex;
    }

    button img {
      width: 10vw;
      height: 20vh;
      object-fit: cover;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 10px;
      width: 80%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #ddd;
      background-color: #f9f9f9;
      margin-bottom: 10px;
      border-radius: 5px;
    }

    .cart-item-info {
      flex: 1;
    }

    .cart-item-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .cart-item-price {
      color: #666;
      font-size: 14px;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .qty-control {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .qty-btn {
      background-color: #0066cc;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 3px;
      font-size: 16px;
    }

    .qty-btn:hover {
      background-color: #0052a3;
    }

    .qty-display {
      min-width: 30px;
      text-align: center;
      font-weight: bold;
    }

    .remove-btn {
      background-color: #cc0000;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 3px;
    }

    .remove-btn:hover {
      background-color: #990000;
    }

    .cart-summary {
      margin-top: 20px;
      padding: 20px;
      background-color: #e8f4e8;
      border-radius: 5px;
      text-align: right;
    }

    .cart-subtotal {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .checkout-btn {
      background-color: #00cc00;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }

    .checkout-btn:hover {
      background-color: #00aa00;
    }

    .empty-cart {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 18px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <button id="cartButton" onclick="openCart()">
    <img src="https://png.pngtree.com/png-clipart/20190920/original/pngtree-shopping-cart-convenient-icon-png-image_4637407.jpg" alt="Shopping Cart"/>
    <div id="cartBadge">0</div>
  </button>

  <!-- Shopping Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCart()">&times;</span>
      <h2>Shopping Cart</h2>
      <div id="cartItems"></div>
      <div id="cartSummary"></div>
    </div>
  </div>

  <h1>Best Buy</h1>
  <h2>By Mahir, Kellen, Chinemerem, and Kira</h2>
  <h3>Needs back-end support.</h3>

  <fieldset style="width:500px; border-color:silver">
    <legend>Welcome to Best Buy!</legend>
    <table>
      <tr>
        <td><b>Enter Fullname...</b></td>
        <td><input type="text" name="fullname" size="40" class="input" required></td>
      </tr>
      <tr>
        <td><b>Enter Address... </b></td>
        <td><textarea name="address" id="addr" rows="5" cols="42" class="input" required></textarea></td>
      </tr>
      <tr>
        <td><b> Enter Birthday... </b></td>
        <td><input type="datetime-local" id="birthdaytime" name="birthdaytime"></td>
      </tr>
      <tr>
        <td><b>Enter Add-ons...  </b></td>
        <td>
          <input type="checkbox" id="insurance" value="A">Insurance Policy
          <input type="checkbox" id="parts" value="M">Replacement Parts
          <input type="checkbox" id="warranty" value="C">Warranty Policy
          <input type="checkbox" id="tech" value="J">Tech Support
        </td>
      </tr>
      <tr>
        <td><b>Enter Payment Method...</b></td>
        <td>
          <select name="holiday" id="slctSingle" class="input" style="width:160px">
            <option value="VD">Discover</option>
            <option value="MD">MasterCard</option>
            <option value="FD">AmericanExpress</option>
            <option value="HD">Visa</option>
            <option value="CD">Paypal</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><b>Enter Appliances you want... </b></td>
        <td>
          <select name="flowers" id="slctMulti" size="3" multiple class="input" style="width:160px">
            <option value="T">Kitchen Appliances</option>
            <option value="P">Washers</option>
            <option value="L">Dryers</option>
            <option value="S">Computers</option>
            <option value="O">Televisions</option>
            <option value="D">Video Game Consoles</option>
            <option value="R">Accessories</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><input type="submit" value="Go"></td>
        <td><input type="reset" value="Clear"></td>
      </tr>
    </table>
  </fieldset>

  <h4>Prices</h4>
  <table style="width:100%">
    <tr><th>Item</th><th>Price</th></tr>
    <tr><td>Refrigerator</td><td>$500</td></tr>
    <tr><td>Microwave</td><td>$300</td></tr>
    <tr><td>Dishwasher</td><td>$450</td></tr>
    <tr><td>Oven</td><td>$550</td></tr>
    <tr><td>Washer</td><td>$600</td></tr>
    <tr><td>Dryer</td><td>$600</td></tr>
    <tr><td>Blender</td><td>$100</td></tr>
    <tr><td>Drip Coffee</td><td>$150</td></tr>
    <tr><td>Laptop</td><td>$200</td></tr>
    <tr><td>TV</td><td>$399</td></tr>
    <tr><td>Speakers</td><td>$199</td></tr>
    <tr><td>Vinyl</td><td>$50</td></tr>
    <tr><td>Switch 2</td><td>$499</td></tr>
    <tr><td>PlayStation 5</td><td>$599</td></tr>
    <tr><td>Xbox Series S</td><td>$399</td></tr>
    <tr><td>Gameboy</td><td>$1</td></tr>
    <tr><td>Headphones</td><td>$49</td></tr>
    <tr><td>Tablet</td><td>$299</td></tr>
    <tr><td>Gaming Desktop</td><td>$999</td></tr>
    <tr><td>Printer</td><td>$230</td></tr>
    <tr><td>Computer Monitor</td><td>$750</td></tr>
    <tr><td>Camera</td><td>$700</td></tr>
    <tr><td>Smart Watch</td><td>$299</td></tr>
    <tr><td>Vacuum</td><td>$100</td></tr>
  </table>

  <div id="row1">
    <button onclick="myItem('Refrigerator')"><img src="https://zlinekitchen.com/cdn/shop/products/zline--french--door--stainless--steel--standard--depth--refrigerator--RSM-W-36--side.jpg?v=1722276759&width=1946"></button>
    <button onclick="myItem('Microwave')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6577/6577280_sd.jpg"></button>
    <button onclick="myItem('Dishwasher')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/28f0ed55-0925-4cf5-92a1-cd8e15b2e4c3.jpg"></button>
    <button onclick="myItem('Oven')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6401/6401963_sd.jpg"></button>
  </div>
 <br>
  <div id="row2">
  <button onclick="myItem('Washer')"><img src="https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRHFP8zaZVxIWcSWSVep64sTKkNXpAUwjc1r-JWgSiIzJec9AgcXtD14uslJUbgiucfnOhAmOkk44xkEKsKSMy_WHA9SAY4XXaflYq8lY1uWl7Wiy_1T6ktrIrGudNit0ONXFR5PDuJX9s&usqp=CAc"></button>
    <button onclick="myItem('Dryer')"><img src="https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcTxzQsvZ5-0y3nx6SmTdPYKqHtnKtUoNMSj27WSABnLIHa0S5rUf3alGypWsHDaEbFhLNdhJOa0uz023MbufcB7e1CImjm-e1jw7hnxunPdJBvaYymoL6uTNEZqUroAiYtVF1jd340dP4I&usqp=CAc"></button>
    <button onclick="myItem('Blender')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6395/6395884_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('DripCoffee')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6553/6553385_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row3">
  <button onclick="myItem('Laptop')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/189f8d5b-03fe-4d49-aa2b-552018e1c819.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('TV')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/0343bc5e-db43-4664-8ef1-8a7255eae875.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Speaker')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/db2aafd7-3ca3-48e3-a7fe-36714093bf8c.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('OutDatedVinyl')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/a495cade-d7b5-4eb8-a36f-c378d3c29ec9.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row4">
  <button onclick="myItem('Switch2')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2d2b885d-0b91-4a0a-b8e0-247fd2b26ab7.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('PlayStation5')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6601/6601524_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('XboxS')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6470/6470289_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('OutDatedGameBoy')"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7c/Game-Boy-FL.png"></button>
  </div>
  <br>
  <div id="row5">
  <button onclick="myItem('Headphones')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/4c7591bb-84b4-4697-b3a7-91ba2d6c83fa.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('IPad')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2a76c272-cd12-43b9-ace9-34df9942ddd6.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('GamingDesktop')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/08c4770e-4f55-494e-a8ed-6604c87bef73.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Printer')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/02d42d73-c9c2-4f3a-a964-6d7d37a9f574.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row6">
  <button onclick="myItem('Monitor')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6208cafc-fd04-4b29-89a5-4b431fde8df7.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Camera')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6536/6536336_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('SmartWatch')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/9ac5d1ec-3b32-4adb-a2f5-adc8b3c047e9.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Vaccum')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/30d1d685-9631-4dcb-b24a-27211cc47de2.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>

  <script>
  const API = "http://127.0.0.1:8000/api";
  const headers = { "Content-Type": "application/json", "x-demo-token": "student1" };

  async function api(path, opts = {}) {
    const res = await fetch(API + path, { headers, ...opts });
    if (!res.ok) throw new Error(await res.text());
    return res.json();
  }

  // Update cart badge
  async function updateCartBadge() {
    try {
      const cart = await api("/cart");
      const itemCount = cart.items.length;
      const badge = document.getElementById("cartBadge");
      
      if (itemCount > 0) {
        badge.textContent = itemCount;
        badge.classList.add("show");
      } else {
        badge.classList.remove("show");
      }
    } catch (e) {
      console.error("Badge update failed:", e);
    }
  }

  // Open cart modal and display items
  async function openCart() {
    const modal = document.getElementById("cartModal");
    modal.style.display = "block";
    
    const cartItems = document.getElementById("cartItems");
    const cartSummary = document.getElementById("cartSummary");
    
    cartItems.innerHTML = '<div class="loading">Loading cart...</div>';
    cartSummary.innerHTML = '';
    
    try {
      const cart = await api("/cart");
      
      if (cart.items.length === 0) {
        cartItems.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
        return;
      }
      
      // Display cart items
      cartItems.innerHTML = cart.items.map(item => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${item.productId}</div>
            <div class="cart-item-price">$${item.price} each</div>
          </div>
          <div class="cart-item-controls">
            <div class="qty-control">
              <button class="qty-btn" onclick="decreaseQty('${item.productId}', ${item.qty})">-</button>
              <span class="qty-display">${item.qty}</span>
              <button class="qty-btn" onclick="increaseQty('${item.productId}', ${item.qty})">+</button>
            </div>
            <button class="remove-btn" onclick="removeItem('${item.productId}')">Remove</button>
          </div>
        </div>
      `).join('');
      
      // Display cart summary
      cartSummary.innerHTML = `
        <div class="cart-summary">
          <div class="cart-subtotal">Subtotal: $${cart.subtotal}</div>
          <button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
        </div>
      `;
    } catch (e) {
      cartItems.innerHTML = '<div class="empty-cart">Error loading cart</div>';
    }
  }

  // Close cart modal
  function closeCart() {
    document.getElementById("cartModal").style.display = "none";
  }

  // Close modal when clicking outside
  window.onclick = function(event) {
    const modal = document.getElementById("cartModal");
    if (event.target == modal) {
      closeCart();
    }
  }

  // Add item to cart
  async function myItem(itemName) {
    try {
      await api("/cart/items", {
        method: "POST",
        body: JSON.stringify({ productId: itemName, qty: 1 })
      });
      alert(itemName + " added to cart");
      await updateCartBadge();
    } catch (e) {
      alert("Add failed");
    }
  }

  // Increase quantity
  async function increaseQty(productId, currentQty) {
    try {
      await api(`/cart/items/${productId}`, {
        method: "PATCH",
        body: JSON.stringify({ qty: currentQty + 1 })
      });
      await openCart();
      await updateCartBadge();
    } catch (e) {
      alert("Update failed");
    }
  }

  // Decrease quantity
  async function decreaseQty(productId, currentQty) {
    if (currentQty <= 1) {
      if (confirm("Remove this item from cart?")) {
        await removeItem(productId);
      }
      return;
    }
    
    try {
      await api(`/cart/items/${productId}`, {
        method: "PATCH",
        body: JSON.stringify({ qty: currentQty - 1 })
      });
      await openCart();
      await updateCartBadge();
    } catch (e) {
      alert("Update failed");
    }
  }

  // Remove item from cart
  async function removeItem(productId) {
    try {
      await api(`/cart/items/${productId}`, {
        method: "DELETE"
      });
      await openCart();
      await updateCartBadge();
    } catch (e) {
      alert("Remove failed");
    }
  }

  // Checkout
  async function checkout() {
    try {
      const order = await api("/orders", { method: "POST" });
      await api("/payments/mock", {
        method: "POST",
        body: JSON.stringify({ orderId: order.id })
      });
      alert("Order placed successfully! Order ID: " + order.id + "\nTotal: $" + order.total);
      closeCart();
      await updateCartBadge();
    } catch (e) {
      alert("Checkout failed: " + e.message);
    }
  }

  // Initialize cart badge on page load
  updateCartBadge();
  </script>

</body>
</html>