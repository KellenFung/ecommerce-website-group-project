<!DOCTYPE html>
<html>
<head>
  <title>E-Commerce</title>
  <style>
    body {
      background-color: #c8f2c2;
      font-family: Arial, sans-serif;
    }

    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
    }

    #cartButton {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: transparent;
      border: none;
      cursor: pointer;
      z-index: 999;
    }

    #cartButton img {
      width: 50px;
      height: 50px;
    }

    #cartButton:hover img {
      transform: scale(1.1);
      transition: transform 0.2s ease-in-out;
    }

    #cartBadge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: #ff3333;
      color: white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      display: none;
    }

    #cartBadge.show {
      display: flex;
    }

    button img {
      width: 10vw;
      height: 20vh;
      object-fit: cover;
    }

    /* ===== Modal overlay ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 10px;
      width: 80%;
      max-width: 1000px;
      max-height: 80vh;
      overflow-y: auto;
      box-sizing: border-box;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
    }

    /* ===== New cart layout (inspired by friend's cart.html) ===== */

    .cart-main-container{
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 20px;
      margin-top: 10px;
    }

    .products_container{
      background-color: white;
      width: 65%;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 150px;
    }

    .product-row{
      display: flex;
      flex-direction: row;
      align-items: center;
      width: 90%;
      min-height: 120px;
      border-bottom: 1px solid #ddd;
      padding: 20px 0;
    }

    .product_image{
      width: 90px;
      height: 80px;
      margin-right: 30px;
      flex-shrink: 0;
    }

    .product_image img{
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .product_description{
      flex: 1;
    }

    .product_description h3 {
      margin: 0 0 6px;
    }

    .product_price {
      margin-bottom: 8px;
      color: #555;
      font-size: 14px;
    }

    .count-container{
      display: flex;
      flex-direction: row;
      height: 27px;
      border: 1px solid black;
      border-radius: 6px;
      font-size: 20px;
    }

    .counter{
      width: 40px;
      border-left: 1px solid black;
      border-right: 1px solid black;
    }

    .subtract-counter,
    .add-counter{
      width: 26px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      user-select: none;
    }

    .subtract-counter:hover,
    .add-counter:hover{
      cursor: pointer;
      background-color: #f0f0f0;
    }

    .counter input{
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      border: none;
      text-align: center;
      font-size: 16px;
      padding: 0;
      background: transparent;
    }

    .counter input:focus{
      outline: none;
    }

    .delete-product{
      align-self: flex-start;
      font-size: 2em;
      margin-left: 20px;
      cursor: pointer;
      margin-top: 10px;
      background: none;
      border: none;
    }

    .delete-product:hover{
      color: red;
    }

    .order-detail-container{
      background-color: white;
      width: 30%;
      height: fit-content;
      padding: 20px;
      box-sizing: border-box;
    }

    .order-summary-title{
      display: flex;
      flex-direction: column;
      align-items: center;
      border-bottom: 1px gray solid;
    }

    .order-summary-details{
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-top: 5px;
      border-bottom: 1px gray solid;
      padding: 3px;
      font-size: 14px;
    }

    .order-summary-total{
      font-weight: 600;
      margin: 10px 0 15px;
    }

    .order-summary-buttons{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #checkout{
      width: 100%;
      height: 40px;
      font-weight: 600;
      background-color: yellow;
      border-radius: 8px;
      border: 1px solid #333;
      cursor: pointer;
    }

    #continue-shopping{
      width: 100%;
      height: 40px;
      font-weight: 600;
      background-color: white;
      border-radius: 8px;
      border: 1px solid #333;
      cursor: pointer;
    }

    .empty-message {
      padding: 30px;
      color: #666;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <button id="cartButton" onclick="openCart()">
    <img src="https://png.pngtree.com/png-clipart/20190920/original/pngtree-shopping-cart-convenient-icon-png-image_4637407.jpg" alt="Shopping Cart"/>
    <div id="cartBadge">0</div>
  </button>

  <!-- Shopping Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCart()">&times;</span>
      <h2>Shopping Cart</h2>

      <div class="cart-main-container">
        <!-- left side: products -->
        <div id="cartProducts" class="products_container">
          <div class="empty-message">Loading cart...</div>
        </div>

        <!-- right side: order summary -->
        <div class="order-detail-container">
          <div class="order-summary">
            <div class="order-summary-title">
              <h3>ORDER SUMMARY</h3>
            </div>
            <div class="order-summary-details">
              <div id="order-subtotal">Subtotal: $0</div>
              <div id="order-shipping">Shipping: $0</div>
              <div id="order-tax">Tax: $0</div>
            </div>
            <div class="order-summary-total">
              <p id="order-total">Total: $0</p>
            </div>
            <div class="order-summary-buttons">
              <button id="checkout" onclick="checkout()">Proceed to Secure Checkout</button>
              <button id="continue-shopping" onclick="closeCart()">Continue Shopping</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <h1>Best Buy</h1>
  <h2>By Mahir, Kellen, Chinemerem, and Kira</h2>
  <h3>Needs back-end support.</h3>

  <fieldset style="width:500px; border-color:silver">
    <legend>Welcome to Best Buy!</legend>
    <table>
      <tr>
        <td><b>Enter Fullname...</b></td>
        <td><input type="text" name="fullname" size="40" class="input" required></td>
      </tr>
      <tr>
        <td><b>Enter Address... </b></td>
        <td><textarea name="address" id="addr" rows="5" cols="42" class="input" required></textarea></td>
      </tr>
      <tr>
        <td><b> Enter Birthday... </b></td>
        <td><input type="datetime-local" id="birthdaytime" name="birthdaytime"></td>
      </tr>
      <tr>
        <td><b>Enter Add-ons...  </b></td>
        <td>
          <input type="checkbox" id="insurance" value="A">Insurance Policy
          <input type="checkbox" id="parts" value="M">Replacement Parts
          <input type="checkbox" id="warranty" value="C">Warranty Policy
          <input type="checkbox" id="tech" value="J">Tech Support
        </td>
      </tr>
      <tr>
        <td><b>Enter Payment Method...</b></td>
        <td>
          <select name="holiday" id="slctSingle" class="input" style="width:160px">
            <option value="VD">Discover</option>
            <option value="MD">MasterCard</option>
            <option value="FD">AmericanExpress</option>
            <option value="HD">Visa</option>
            <option value="CD">Paypal</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><b>Enter Appliances you want... </b></td>
        <td>
          <select name="flowers" id="slctMulti" size="3" multiple class="input" style="width:160px">
            <option value="T">Kitchen Appliances</option>
            <option value="P">Washers</option>
            <option value="L">Dryers</option>
            <option value="S">Computers</option>
            <option value="O">Televisions</option>
            <option value="D">Video Game Consoles</option>
            <option value="R">Accessories</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><input type="submit" value="Go"></td>
        <td><input type="reset" value="Clear"></td>
      </tr>
    </table>
  </fieldset>

  <h4>Prices</h4>
  <table style="width:100%">
    <tr><th>Item</th><th>Price</th></tr>
    <tr><td>Refrigerator</td><td>$500</td></tr>
    <tr><td>Microwave</td><td>$300</td></tr>
    <tr><td>Dishwasher</td><td>$450</td></tr>
    <tr><td>Oven</td><td>$550</td></tr>
    <tr><td>Washer</td><td>$600</td></tr>
    <tr><td>Dryer</td><td>$600</td></tr>
    <tr><td>Blender</td><td>$100</td></tr>
    <tr><td>Drip Coffee</td><td>$150</td></tr>
    <tr><td>Laptop</td><td>$200</td></tr>
    <tr><td>TV</td><td>$399</td></tr>
    <tr><td>Speakers</td><td>$199</td></tr>
    <tr><td>Vinyl</td><td>$50</td></tr>
    <tr><td>Switch 2</td><td>$499</td></tr>
    <tr><td>PlayStation 5</td><td>$599</td></tr>
    <tr><td>Xbox Series S</td><td>$399</td></tr>
    <tr><td>Gameboy</td><td>$1</td></tr>
    <tr><td>Headphones</td><td>$49</td></tr>
    <tr><td>Tablet</td><td>$299</td></tr>
    <tr><td>Gaming Desktop</td><td>$999</td></tr>
    <tr><td>Printer</td><td>$230</td></tr>
    <tr><td>Computer Monitor</td><td>$750</td></tr>
    <tr><td>Camera</td><td>$700</td></tr>
    <tr><td>Smart Watch</td><td>$299</td></tr>
    <tr><td>Vacuum</td><td>$100</td></tr>
  </table>

  <!-- product image grid (unchanged) -->
  <div id="row1">
    <button onclick="myItem('Refrigerator')"><img src="https://zlinekitchen.com/cdn/shop/products/zline--french--door--stainless--steel--standard--depth--refrigerator--RSM-W-36--side.jpg?v=1722276759&width=1946"></button>
    <button onclick="myItem('Microwave')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6577/6577280_sd.jpg"></button>
    <button onclick="myItem('Dishwasher')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/28f0ed55-0925-4cf5-92a1-cd8e15b2e4c3.jpg"></button>
    <button onclick="myItem('Oven')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6401/6401963_sd.jpg"></button>
  </div>
  <br>
  <div id="row2">
    <button onclick="myItem('Washer')"><img src="https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRHFP8zaZVxIWcSWSVep64sTKkNXpAUwjc1r-JWgSiIzJec9AgcXtD14uslJUbgiucfnOhAmOkk44xkEKsKSMy_WHA9SAY4XXaflYq8lY1uWl7Wiy_1T6ktrIrGudNit0ONXFR5PDuJX9s&usqp=CAc"></button>
    <button onclick="myItem('Dryer')"><img src="https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcTxzQsvZ5-0y3nx6SmTdPYKqHtnKtUoNMSj27WSABnLIHa0S5rUf3alGypWsHDaEbFhLNdhJOa0uz023MbufcB7e1CImjm-e1jw7hnxunPdJBvaYymoL6uTNEZqUroAiYtVF1jd340dP4I&usqp=CAc"></button>
    <button onclick="myItem('Blender')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6395/6395884_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('DripCoffee')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6553/6553385_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row3">
    <button onclick="myItem('Laptop')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/189f8d5b-03fe-4d49-aa2b-552018e1c819.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('TV')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/0343bc5e-db43-4664-8ef1-8a7255eae875.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Speaker')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/db2aafd7-3ca3-48e3-a7fe-36714093bf8c.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('OutDatedVinyl')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/a495cade-d7b5-4eb8-a36f-c378d3c29ec9.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row4">
    <button onclick="myItem('Switch2')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2d2b885d-0b91-4a0a-b8e0-247fd2b26ab7.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('PlayStation5')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6601/6601524_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('XboxS')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6470/6470289_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('OutDatedGameBoy')"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7c/Game-Boy-FL.png"></button>
  </div>
  <br>
  <div id="row5">
    <button onclick="myItem('Headphones')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/4c7591bb-84b4-4697-b3a7-91ba2d6c83fa.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('IPad')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2a76c272-cd12-43b9-ace9-34df9942ddd6.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('GamingDesktop')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/08c4770e-4f55-494e-a8ed-6604c87bef73.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Printer')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/02d42d73-c9c2-4f3a-a964-6d7d37a9f574.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>
  <br>
  <div id="row6">
    <button onclick="myItem('Monitor')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6208cafc-fd04-4b29-89a5-4b431fde8df7.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Camera')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6536/6536336_sd.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('SmartWatch')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/9ac5d1ec-3b32-4adb-a2f5-adc8b3c047e9.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
    <button onclick="myItem('Vaccum')"><img src="https://pisces.bbystatic.com/image2/BestBuy_US/images/products/30d1d685-9631-4dcb-b24a-27211cc47de2.jpg;maxHeight=1920;maxWidth=900?format=webp"></button>
  </div>

  <script>
    const API = "http://127.0.0.1:8000/api";
    const headers = { "Content-Type": "application/json", "x-demo-token": "student1" };

    async function api(path, opts = {}) {
      const res = await fetch(API + path, { headers, ...opts });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    // Map productId -> image URL (optional, you can tweak these)
    const productImages = {
      Refrigerator: "https://zlinekitchen.com/cdn/shop/products/zline--french--door--stainless--steel--standard--depth--refrigerator--RSM-W-36--side.jpg?v=1722276759&width=1946",
      Microwave: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6577/6577280_sd.jpg",
      Dishwasher: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/28f0ed55-0925-4cf5-92a1-cd8e15b2e4c3.jpg",
      Oven: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6401/6401963_sd.jpg",
      Washer: "https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRHFP8zaZVxIWcSWSVep64sTKkNXpAUwjc1r-JWgSiIzJec9AgcXtD14uslJUbgiucfnOhAmOkk44xkEKsKSMy_WHA9SAY4XXaflYq8lY1uWl7Wiy_1T6ktrIrGudNit0ONXFR5PDuJX9s&usqp=CAc",
      Dryer: "https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcTxzQsvZ5-0y3nx6SmTdPYKqHtnKtUoNMSj27WSABnLIHa0S5rUf3alGypWsHDaEbFhLNdhJOa0uz023MbufcB7e1CImjm-e1jw7hnxunPdJBvaYymoL6uTNEZqUroAiYtVF1jd340dP4I&usqp=CAc",
      Blender: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6395/6395884_sd.jpg",
      DripCoffee: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6553/6553385_sd.jpg",
      Laptop: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/189f8d5b-03fe-4d49-aa2b-552018e1c819.jpg",
      TV: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/0343bc5e-db43-4664-8ef1-8a7255eae875.jpg",
      Speaker: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/db2aafd7-3ca3-48e3-a7fe-36714093bf8c.jpg",
      OutDatedVinyl: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/a495cade-d7b5-4eb8-a36f-c378d3c29ec9.jpg",
      Switch2: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2d2b885d-0b91-4a0a-b8e0-247fd2b26ab7.jpg",
      PlayStation5: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6601/6601524_sd.jpg",
      XboxS: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6470/6470289_sd.jpg",
      OutDatedGameBoy: "https://upload.wikimedia.org/wikipedia/commons/7/7c/Game-Boy-FL.png",
      Headphones: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/4c7591bb-84b4-4697-b3a7-91ba2d6c83fa.jpg",
      IPad: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/2a76c272-cd12-43b9-ace9-34df9942ddd6.jpg",
      GamingDesktop: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/08c4770e-4f55-494e-a8ed-6604c87bef73.jpg",
      Printer: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/02d42d73-c9c2-4f3a-a964-6d7d37a9f574.jpg",
      Monitor: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6208cafc-fd04-4b29-89a5-4b431fde8df7.jpg",
      Camera: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/6536/6536336_sd.jpg",
      SmartWatch: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/9ac5d1ec-3b32-4adb-a2f5-adc8b3c047e9.jpg",
      Vaccum: "https://pisces.bbystatic.com/image2/BestBuy_US/images/products/30d1d685-9631-4dcb-b24a-27211cc47de2.jpg"
    };

    // badge
    async function updateCartBadge() {
      try {
        const cart = await api("/cart");
        const itemCount = cart.items.length;
        const badge = document.getElementById("cartBadge");

        if (itemCount > 0) {
          badge.textContent = itemCount;
          badge.classList.add("show");
        } else {
          badge.classList.remove("show");
        }
      } catch (e) {
        console.error("Badge update failed:", e);
      }
    }

    // Build cart rows in modal
    async function loadCart() {
      const container = document.getElementById("cartProducts");
      container.innerHTML = '<div class="empty-message">Loading cart...</div>';

      try {
        const cart = await api("/cart");

        if (!cart.items.length) {
          container.innerHTML = '<div class="empty-message">Your cart is empty.</div>';
          updateSummary(0);
          return;
        }

        container.innerHTML = "";
        cart.items.forEach(item => {
          container.appendChild(createProductRow(item));
        });

        updateSummary(cart.subtotal);
      } catch (e) {
        container.innerHTML = '<div class="empty-message">Error loading cart.</div>';
      }
    }

    function createProductRow(item) {
      const productId = item.productId;
      const price = item.price;
      const qty = item.qty;

      const row = document.createElement("div");
      row.className = "product-row";
      row.dataset.productId = productId;

      const imgDiv = document.createElement("div");
      imgDiv.className = "product_image";
      const img = document.createElement("img");
      img.alt = productId;
      img.src = productImages[productId] || "https://via.placeholder.com/80x80?text=Item";
      imgDiv.appendChild(img);

      const descDiv = document.createElement("div");
      descDiv.className = "product_description";

      const title = document.createElement("h3");
      title.textContent = productId;

      const priceDiv = document.createElement("div");
      priceDiv.className = "product_price";
      priceDiv.textContent = `$${price} each`;

      const countContainer = document.createElement("div");
      countContainer.className = "count-container";

      const minus = document.createElement("div");
      minus.className = "subtract-counter";
      minus.textContent = "-";

      const counter = document.createElement("div");
      counter.className = "counter";

      const input = document.createElement("input");
      input.type = "text";
      input.className = "quantity-input";
      input.value = qty;

      counter.appendChild(input);

      const plus = document.createElement("div");
      plus.className = "add-counter";
      plus.textContent = "+";

      countContainer.appendChild(minus);
      countContainer.appendChild(counter);
      countContainer.appendChild(plus);

      descDiv.appendChild(title);
      descDiv.appendChild(priceDiv);
      descDiv.appendChild(countContainer);

      const delBtn = document.createElement("button");
      delBtn.className = "delete-product";
      delBtn.innerHTML = "&times;";

      row.appendChild(imgDiv);
      row.appendChild(descDiv);
      row.appendChild(delBtn);

      // handlers
      minus.addEventListener("click", () => changeQty(productId, parseInt(input.value || "1", 10) - 1));
      plus.addEventListener("click", () => changeQty(productId, parseInt(input.value || "1", 10) + 1));
      delBtn.addEventListener("click", () => removeItem(productId));

      return row;
    }

    async function changeQty(productId, newQty) {
      if (newQty <= 0) {
        if (confirm("Remove this item from cart?")) {
          await removeItem(productId);
        }
        return;
      }
      try {
        await api(`/cart/items/${productId}`, {
          method: "PATCH",
          body: JSON.stringify({ qty: newQty })
        });
        await loadCart();
        await updateCartBadge();
      } catch (e) {
        alert("Failed to update quantity");
      }
    }

    async function removeItem(productId) {
      try {
        await api(`/cart/items/${productId}`, {
          method: "DELETE"
        });
        await loadCart();
        await updateCartBadge();
      } catch (e) {
        alert("Failed to remove item");
      }
    }

    function updateSummary(subtotal) {
      const shipping = subtotal > 0 ? 0 : 0; 
      const taxRate = 0.08;
      const tax = Math.round(subtotal * taxRate * 100) / 100;
      const total = subtotal + shipping + tax;

      document.getElementById("order-subtotal").textContent = `Subtotal: $${subtotal}`;
      document.getElementById("order-shipping").textContent = `Shipping: $${shipping}`;
      document.getElementById("order-tax").textContent = `Tax: $${tax}`;
      document.getElementById("order-total").textContent = `Total: $${total}`;
    }

    async function openCart() {
      const modal = document.getElementById("cartModal");
      modal.style.display = "block";
      await loadCart();
    }

    function closeCart() {
      document.getElementById("cartModal").style.display = "none";
    }

    window.onclick = function(event) {
      const modal = document.getElementById("cartModal");
      if (event.target === modal) {
        closeCart();
      }
    };

    // Add item to cart from product grid
    async function myItem(itemName) {
      try {
        await api("/cart/items", {
          method: "POST",
          body: JSON.stringify({ productId: itemName, qty: 1 })
        });
        alert(itemName + " added to cart");
        await updateCartBadge();
      } catch (e) {
        alert("Add failed");
      }
    }

    // Checkout using existing backend
    async function checkout() {
      try {
        const order = await api("/orders", { method: "POST" });
        await api("/payments/mock", {
          method: "POST",
          body: JSON.stringify({ orderId: order.id })
        });
        alert(`Order placed successfully! Order ID: ${order.id}\nTotal: $${order.total}`);
        closeCart();
        await updateCartBadge();
      } catch (e) {
        alert("Checkout failed: " + e.message);
      }
    }

    // init badge
    updateCartBadge();
  </script>
</body>
</html>
